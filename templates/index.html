<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Blueprint | –õ–∏—á–Ω—ã–π HQ</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Raleway:wght@300;400&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="bg-image"></div>

        <div class="content">
            <header>
                <div class="date" id="date">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 25 –Ω–æ—è–±—Ä—è</div>
                <h1 class="greeting" id="greeting">–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, —Å—Ç—Ä–∞—Ç–µ–≥</h1>
            </header>

            <main>
                <!-- –ì–ª–∞–≤–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞ -->
                <div class="card main-card">
                    <div class="card-content">
                        <div class="quote" id="quote">
                            "–°–∞–º—ã–µ —É—Å–ø–µ—à–Ω—ã–µ –ª—é–¥–∏ –≤–∏–¥—è—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–∞–º, –≥–¥–µ –¥—Ä—É–≥–∏–µ –≤–∏–¥—è—Ç –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è."
                        </div>
                        <div class="author">‚Äî –ò–∑ –¥–æ—Å—å–µ CEO</div>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ü–µ–ª–µ–π -->
                <div class="goals-container">

                    <!-- –î–Ω–µ–≤–Ω—ã–µ —Ü–µ–ª–∏ -->
                    <div class="goals-section daily">
                        <div class="section-header">
                            <h2>üìÖ –°–µ–≥–æ–¥–Ω—è</h2>
                            <button class="add-btn" onclick="showAddForm('daily')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>

                        <div class="progress-section small">
                            <div class="progress-bar">
                                <div class="progress-fill daily-progress" id="dailyProgressFill"></div>
                            </div>
                            <div class="progress-text" id="dailyProgressText">–ü—Ä–æ–≥—Ä–µ—Å—Å: 0%</div>
                        </div>

                        <div id="dailyGoalsList" class="goals-list">
                            <!-- –î–Ω–µ–≤–Ω—ã–µ —Ü–µ–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                        </div>
                    </div>

                    <!-- –ù–µ–¥–µ–ª—å–Ω—ã–µ —Ü–µ–ª–∏ -->
                    <div class="goals-section weekly">
                        <div class="section-header">
                            <h2>üóìÔ∏è –ù–∞ –Ω–µ–¥–µ–ª—é</h2>
                            <button class="add-btn" onclick="showAddForm('weekly')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>

                        <div class="progress-section small">
                            <div class="progress-bar">
                                <div class="progress-fill weekly-progress" id="weeklyProgressFill"></div>
                            </div>
                            <div class="progress-text" id="weeklyProgressText">–ü—Ä–æ–≥—Ä–µ—Å—Å: 0%</div>
                        </div>

                        <div id="weeklyGoalsList" class="goals-list">
                            <!-- –ù–µ–¥–µ–ª—å–Ω—ã–µ —Ü–µ–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                        </div>
                    </div>

                </div>
            </main>

            <footer>
                <button class="refresh-btn" onclick="loadData()">‚ú® –û–±–Ω–æ–≤–∏—Ç—å —Ü–∏—Ç–∞—Ç—É</button>
                <div class="footer-note">The Blueprint ‚Ä¢ –í–∞—à –ª–∏—á–Ω—ã–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä</div>
            </footer>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª–∏ -->
    <div id="addGoalModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>–ù–æ–≤–∞—è —Ü–µ–ª—å</h3>
            <div class="modal-type-selector">
                <button class="type-btn active" data-type="daily" onclick="selectType('daily')">–ù–∞ –¥–µ–Ω—å</button>
                <button class="type-btn" data-type="weekly" onclick="selectType('weekly')">–ù–∞ –Ω–µ–¥–µ–ª—é</button>
            </div>
            <textarea id="goalText" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞..." rows="3"></textarea>
            <button class="submit-btn" onclick="addGoal()">–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</button>
        </div>
    </div>

    <!-- –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—Å–µ—Ö —Ü–µ–ª–µ–π -->
    <div id="congratsModal" class="modal congrats">
        <div class="modal-content">
            <div class="confetti">üéâ</div>
            <h3>–¢—ã –º–æ–ª–æ–¥–µ—Ü!</h3>
            <p>–í—Å–µ —Ü–µ–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! –•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ?</p>
            <button class="submit-btn" onclick="showAddForm('weekly')">–î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ü–µ–ª–∏</button>
            <button class="submit-btn secondary" onclick="showAddForm('daily')">–î–æ–±–∞–≤–∏—Ç—å –¥–Ω–µ–≤–Ω—ã–µ —Ü–µ–ª–∏</button>
            <button class="close-btn" onclick="closeCongrats()">–û—Ç–¥–æ—Ö–Ω—É—Ç—å –∏ –Ω–∞—Å–ª–∞–¥–∏—Ç—å—Å—è –º–æ–º–µ–Ω—Ç–æ–º ‚òï</button>
        </div>
    </div>

    <script>
    let currentGoalType = 'daily';

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    async function loadData() {
        try {
            const response = await fetch('/api/data');
            const data = await response.json();

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            document.getElementById('greeting').textContent = data.greeting;
            document.getElementById('date').textContent = data.date;
            document.getElementById('quote').textContent = '"' + data.quote + '"';

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const dailyProgressFill = document.getElementById('dailyProgressFill');
            const dailyProgressText = document.getElementById('dailyProgressText');
            const weeklyProgressFill = document.getElementById('weeklyProgressFill');
            const weeklyProgressText = document.getElementById('weeklyProgressText');

            dailyProgressFill.style.width = data.daily_progress + '%';
            dailyProgressText.textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${data.daily_progress}%`;

            weeklyProgressFill.style.width = data.weekly_progress + '%';
            weeklyProgressText.textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${data.weekly_progress}%`;

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–Ω–µ–≤–Ω—ã–µ —Ü–µ–ª–∏
            const dailyGoalsList = document.getElementById('dailyGoalsList');
            dailyGoalsList.innerHTML = '';

            data.daily_goals.forEach(goal => {
                const goalDiv = document.createElement('div');
                goalDiv.className = 'goal-item daily';
                goalDiv.innerHTML = `
                    <span class="goal-text ${goal.completed ? 'completed' : ''}">
                        <span class="status-icon">${goal.completed ? '‚úÖ' : '‚ö™'}</span>
                        ${goal.text}
                    </span>
                    <div class="goal-actions">
                        <button class="action-btn toggle-btn" onclick="toggleGoal(${goal.id})">
                            ${goal.completed ? '‚Ü©Ô∏é' : '‚úì'}
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteGoal(${goal.id})">üóëÔ∏è</button>
                    </div>
                `;
                dailyGoalsList.appendChild(goalDiv);
            });

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ü–µ–ª–∏
            const weeklyGoalsList = document.getElementById('weeklyGoalsList');
            weeklyGoalsList.innerHTML = '';

            data.weekly_goals.forEach(goal => {
                const goalDiv = document.createElement('div');
                goalDiv.className = 'goal-item weekly';
                goalDiv.innerHTML = `
                    <span class="goal-text ${goal.completed ? 'completed' : ''}">
                        <span class="status-icon">${goal.completed ? '‚úÖ' : '‚ö™'}</span>
                        ${goal.text}
                    </span>
                    <div class="goal-actions">
                        <button class="action-btn toggle-btn" onclick="toggleGoal(${goal.id})">
                            ${goal.completed ? '‚Ü©Ô∏é' : '‚úì'}
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteGoal(${goal.id})">üóëÔ∏è</button>
                    </div>
                `;
                weeklyGoalsList.appendChild(goalDiv);
            });

            // === –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê ===
            // –°—á–∏—Ç–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–µ–ª–µ–π –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö
            const totalGoals = data.daily_goals.length + data.weekly_goals.length;
            const completedGoals =
                data.daily_goals.filter(g => g.completed).length +
                data.weekly_goals.filter(g => g.completed).length;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Ü–µ–ª–∏ –∏ –í–°–ï –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
            if (totalGoals > 0 && totalGoals === completedGoals) {
                setTimeout(() => {
                    document.getElementById('congratsModal').style.display = 'block';
                }, 500);
            }

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
        }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª–∏
    function showAddForm(type) {
        // –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ
        document.getElementById('congratsModal').style.display = 'none';

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø
        currentGoalType = type;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = document.getElementById('addGoalModal');
        modal.style.display = 'block';

        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É —Ç–∏–ø–∞
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`.type-btn[data-type="${type}"]`).classList.add('active');

        // –û—á–∏—â–∞–µ–º –∏ —Ñ–æ–∫—É—Å–∏—Ä—É–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
        const textarea = document.getElementById('goalText');
        textarea.value = '';

        // –î–∞—ë–º –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–µ—Ä–µ–¥ —Ñ–æ–∫—É—Å–æ–º
        setTimeout(() => {
            textarea.focus();
        }, 100);
    }

    // –í—ã–±—Ä–∞—Ç—å —Ç–∏–ø —Ü–µ–ª–∏
    function selectType(type) {
        currentGoalType = type;
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`.type-btn[data-type="${type}"]`).classList.add('active');
    }

    // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª–∏
    function closeModal() {
        document.getElementById('addGoalModal').style.display = 'none';
        document.getElementById('goalText').value = '';
    }

    // –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å
    async function addGoal() {
        const text = document.getElementById('goalText').value.trim();

        if (!text) {
            alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ü–µ–ª–∏');
            return;
        }

        try {
            const response = await fetch('/api/add-goal', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    type: currentGoalType,
                    text: text
                })
            });

            if (response.ok) {
                closeModal();
                loadData(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π
            } else {
                const error = await response.json();
                alert(error.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ü–µ–ª–∏');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª–∏:', error);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ü–µ–ª–∏');
        }
    }

    // –û—Ç–º–µ—Ç–∏—Ç—å/—Å–Ω—è—Ç—å –æ—Ç–º–µ—Ç–∫—É —Ü–µ–ª–∏
    async function toggleGoal(goalId) {
        try {
            const response = await fetch(`/api/toggle/${goalId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                const goalItem = document.querySelector(`.goal-item:has(button[onclick="toggleGoal(${goalId})"])`);
                if (goalItem) {
                    goalItem.classList.add('just-completed');
                    setTimeout(() => {
                        goalItem.classList.remove('just-completed');
                    }, 500);
                }

                loadData(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ —Ü–µ–ª–∏:', error);
        }
    }

    // –£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å
    async function deleteGoal(goalId) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ü–µ–ª—å?')) {
            return;
        }

        try {
            const response = await fetch(`/api/delete/${goalId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                loadData(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ü–µ–ª–∏:', error);
        }
    }

    // –ó–∞–∫—Ä—ã—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
    function closeCongrats() {
        document.getElementById('congratsModal').style.display = 'none';
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    document.addEventListener('DOMContentLoaded', function() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        loadData();
    });

    // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    window.onclick = function(event) {
        const modal = document.getElementById('addGoalModal');
        if (event.target == modal) {
            closeModal();
        }

        const congratsModal = document.getElementById('congratsModal');
        if (event.target == congratsModal) {
            closeCongrats();
        }
    }

    // –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter –≤ textarea
    document.getElementById('goalText')?.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && e.ctrlKey) {
            e.preventDefault();
            addGoal();
        }
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π (–µ—Å–ª–∏ –Ω–µ—Ç –≤ CSS)
    const style = document.createElement('style');
    style.textContent = `
        .just-completed {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
    `;
    document.head.appendChild(style);
    </script>
</body>
</html>